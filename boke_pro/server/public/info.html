<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>博客</title>
    <link rel="stylesheet" href="./css/mybase.css">
    <script src="/js/myjs.js"></script>
</head>

<body>
    <!-- 渐变色 -->
    <header class="topLine"></header>
    <!-- 导航栏 -->
    <div class="top">
        <span>王康的个人博客</span>
        <nav>
            <a href="/index.html">首页</a>
            <a href="/list.html">个人博客日记</a>
            <a href="/list1.html">最新博文</a>
            <a href="/youxiu.html">优秀个人博客</a>
            <a href="/aboutme.html">关于我</a>
            <a href="/admin/shoucang">收藏列表</a>
            <a href="/store.html">商城</a>
            <a href="/shopcar/gotoshopcar">购物车</a>
        </nav>
        <div class="top_right">
            <span>xx欢迎回来 </span>
            <a href="/userlogin.html" class="loginIn">还没有登录请登录</a>
            <a href="/admin/loginOut" class="loginOut">退出登录</a>
        </div>
    </div>
    <!-- 主体部分 -->
    <div id="body">
        <div class="warp-info">
            <h1 id="title">如何写一段好大的博客标题</h1>
            <p class="subTitle" id="subTitle">心得体会</p>
            <p class="time" id="time">发表时间2019:5:31</p>
            <p class="count" id="count">阅读量:88822</p>
            <a href="javascript:shoucang()">收藏本博客</a>
            <div class="content" id="content">
                <p>&nbsp;音场或王是能治正什太，千始查拉承观拉头。</p>

                <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;确现油为到太何使矿车空，民更身名而素多族情院式，文深I式旱解翻导无。</p>

                <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;和法且对究团合持行相，图建回中易头后个一，至步Y少共何导约。 品学须技达报造去属除，老电选平王事都备，十极E标劳Y杨至。</p>

                <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;金书科别花里铁研标龙，低体马适法连验值，石律否惹容旷么走。</p>

                <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;主听什始历新作山，前十改平进想，局目7问Q积。 年公名任应物据，计文流军准八直，白Z花奔相。</p>

                <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;状反里身任严干精所，或白不江式飞铁并最，率V听反<img alt="" height="140"
                        src="/upload/461de44f6df0cc58392467eab20af1cd.jpg" width="200" />S经验。 能准求立眼想先任，民圆会省车万本观，器M到励不见。
                    把形习处八入回相并给毛原，按到统进录奔钉流此。</p>

                <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;好直九容单府然之行是关，起命算关李3适区。 维入京设马的被号状府，结装养义阶识律照高，行片P枣小许类I共。
                    须质有断织才世，个其总相后属，间届观种根。 品她发老北向价般清从区见认老，元公写被求DR分民始资。</p>

                <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;通马美府对导不强往了生他，力等究照科消接如越该，当天组束坝节U安松已。</p>

                <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;增界细主林听书专例，取本接方W农利。 型从快直地近由则，内际我级准总，难工X经岗磨。</p>

                <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;小题八就别难前写战每，电建圆果则各往得没，构四该还及财B统。 半省道离深看增千育经受，习电资理么是受广太，出华肃报杏建算动去。
                    华适是出物许性法件织，明的世原本对治例，风林W联秧租边广。 织真人特走员南月工，改心义们六值状使，维况极素点租阶。</p>

                <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;性是支重海则应步并石，决支条构制住运规市每，基名R伶低抛7。 参学非实要并片保集运选儿，我查器众系二更增价，没历因询坑你私劳问太。
                </p>

                <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;边断接府较需许变，那者交海标热参方，小S统会到I。 所十干值料他查层个，根见格分K题两。</p>

            </div>
            <div class="pinglun">
                <!-- <input type="text"> -->
                <textarea  placeholder="你想说些什么" class="inputText"></textarea>
                <input type="button"  value="提交评论" class="inputBtn">
            </div>
            <div class="yonghupinglun">
                <ul>
                    <li>
                        <div>
                            <span class="uName"  >小白</span>
                            <span class="ptime">2018-4-10</span>
                        </div>
                        <div class="plContent">
                            写的很不错哦哦
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <footer class="bodyfooter-info">
        <div class="top">

        </div>
    </footer>
    <script>
        //    <h1 id="title">如何写一段好大的博客标题</h1>
        //     <p class="subTitle" id="subTitle">心得体会</p>
        //     <p class="time" id="time">发表时间2019:5:31</p>
        //     <p class="count">阅读量:88822</p>
        //     <div class="content" id="content">
        var urlParams = new URLSearchParams(location.search);
        var bid = urlParams.get("bid");
        var bokeUrl = "/blog/queryById?bid=" + bid;
        ajax_get(bokeUrl, (obj) => {
            var model = obj["data"][0];
            console.log(model);

            title.innerHTML = model.btitle;
            subTitle.innerHTML = getLableByNunber(model.labelId)
            content.innerHTML = model.bcontent;
            var date = new Date(model.btiem);
            time.innerHTML = "发表时间:" + date.toLocaleDateString();
        });

        function shoucang() {
            var body = "bid=" + bid;
            ajax_post("/blog/addCollect", (obj => {
                console.log("返回的数据对象" + obj);
                if (obj["code"] == 201) {
                    var url = obj["url"]
                    alert("请登录")
                    window.location.href = url;
                } else {
                    alert('收藏成功');
                }
            }), body)
        }
        var urlParams = new URLSearchParams(location.search);
        var bid = urlParams.get("bid");
        ajax_post("/blog/updateClick", (result) => {
            // console.log("点击量:" + result["data"]);
            count.innerHTML = "点击量:" + result["data"];
        }, "bid=" + bid);
        topRightInit();
    function loadPinglun(){
        ajax_get("/blog/pinglun"+"?blogId="+bid,(result)=>{
            console.log(result);
            let  ul = document.querySelector(".yonghupinglun > ul");
            let  html = "";
            for(let i=0;i<result["data"].length;i++){
                let  model = result["data"][i];
                html +=`
                <li data-id=${model.pid}>
                <div>
                            <span class="uName"  data-id-"15">用户：${model.uanme}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                            <span class="ptime">时间:${model.ptime}</span>
                        </div>
                        <div class="plContent">
                           评论:${model.content}
                        </div>
                </li>
                `
            }
            ul.innerHTML = html;
        },null)
    }
    loadPinglun();


    let inputBtn = document.getElementsByClassName("inputBtn")[0];
    inputBtn.onclick = function(){
        let uName=document.cookie.split("=")[1];
        if(uName&&uName.length!=0){
            let  inputText = document.getElementsByClassName("inputText")[0]
            let content =inputText.value;
            if(content.length==0){
                alert("评论为空");
                return ;
            }
            // console.log(content);
            // let blogId =req.body.blogId;
    // let content = req.body.content;
            ajax_post("/blog/addComment",(result)=>{
                loadPinglun();
            },"blogId="+bid+"&content="+content);
        }else{
            alert("请登录")
            location.href="/userlogin.html";
        }
    }
    </script>
</body>

</html>